<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Starfield</title>
  </head>
  <body>
    <canvas id="canvas" width="1920" height="1080"></canvas>
    <script>
      const WIDTH = 1920;
      const HEIGHT = 1080;
      const NUM_STARS = 50_000;
      const DISTANCE = 2;

      const TAU = 2 * Math.PI;

      const canvas = document.getElementById("canvas");
      const c = canvas.getContext("2d");

      function toHex(v) {
        return Math.min(255, Math.max(0, Math.round(v)))
          .toString(16)
          .padStart(2, "0");
      }

      const stars = [];
      for (let i = 0; i < NUM_STARS; i++) {
        const z = Math.random();

        const intensity = Math.pow(z, 8) * 255;

        const star = {
          x: Math.random() * WIDTH,
          y: Math.random() * HEIGHT,
          z,
          radius: Math.max(0.75, Math.pow(z, 32) * 1.5),
          fillStyle: `#FFFFFF${toHex(intensity)}`,
        };
        stars.push(star);
      }
      stars.sort((lhs, rhs) => Math.sign(lhs.z - rhs.z));

      function tick() {
        for (const star of stars) {
          star.x += DISTANCE * Math.pow(star.z, 32);
          while (star.x >= WIDTH) {
            star.x -= WIDTH;
          }
        }

        c.fillStyle = "black";
        c.fillRect(0, 0, canvas.width, canvas.height);

        for (const star of stars) {
          c.beginPath();
          c.arc(star.x, star.y, star.radius, 0, TAU, false);
          c.fillStyle = star.fillStyle;
          c.fill();
        }

        requestAnimationFrame(tick);
      }

      requestAnimationFrame(tick);
    </script>
  </body>
</html>
